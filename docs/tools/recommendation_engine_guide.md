# RecommendationEngine V2.0 - Guia Completo

## üìã √çndice
1. [Vis√£o Geral](#vis√£o-geral)
2. [Instala√ß√£o e Configura√ß√£o](#instala√ß√£o-e-configura√ß√£o)
3. [Tipos de Recomenda√ß√µes](#tipos-de-recomenda√ß√µes)
4. [Integra√ß√£o com CrewAI](#integra√ß√£o-com-crewai)
5. [Exemplos Pr√°ticos](#exemplos-pr√°ticos)
6. [API Reference](#api-reference)
7. [Performance e Monitoramento](#performance-e-monitoramento)
8. [Troubleshooting](#troubleshooting)

---

## üéØ Vis√£o Geral

O **RecommendationEngine V2.0** √© um sistema inteligente de recomenda√ß√µes otimizado para joalherias e integra√ß√£o com CrewAI. Utiliza algoritmos avan√ßados de Machine Learning para fornecer insights acion√°veis em 6 √°reas principais:

### ‚úÖ Funcionalidades Implementadas
- **üõçÔ∏è Recomenda√ß√µes de Produtos** - ML H√≠brido (Collaborative + Content-based filtering)
- **üéØ Segmenta√ß√£o de Clientes** - RFM Analysis + K-means Clustering
- **üí∞ Otimiza√ß√£o de Pre√ßos** - An√°lise de elasticidade e variabilidade
- **üì¶ Gest√£o de Estoque** - An√°lise ABC + Rotatividade
- **üì¢ Campanhas de Marketing** - Segmenta√ß√£o avan√ßada + ROI prediction
- **üéØ A√ß√µes Estrat√©gicas** - Business Intelligence + Trend analysis

### üöÄ Algoritmos ML Avan√ßados
- **Collaborative Filtering** usando Matrix Factorization (SVD)
- **Content-based Filtering** com TF-IDF vectorization
- **Market Basket Analysis** com algoritmo Apriori
- **Anomaly Detection** usando Isolation Forest
- **Customer Lifetime Value** prediction
- **Sele√ß√£o autom√°tica de algoritmos** baseada nos dados

---

## üõ† Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
```bash
Python 3.8+
pandas, numpy, scikit-learn, mlxtend
crewai (para integra√ß√£o)
```

### Instala√ß√£o
```bash
# Clonar reposit√≥rio
git clone <repo-url>
cd insights-ai

# Instalar depend√™ncias
pip install -r requirements.txt

# Verificar instala√ß√£o
python -c "from src.insights.tools.advanced.recommendation_engine import RecommendationEngine; print('‚úÖ Instala√ß√£o OK')"
```

### Estrutura de Dados Requerida
O sistema espera um arquivo CSV com as seguintes colunas:
```
Data, Codigo_Cliente, Nome_Cliente, Codigo_Produto, 
Descricao_Produto, Grupo_Produto, Quantidade, 
Total_Liquido, Preco_Tabela
```

---

## üîç Tipos de Recomenda√ß√µes

### 1. üõçÔ∏è Product Recommendations
**Objetivo**: Recomendar produtos baseado em padr√µes de compra e similaridade

**Algoritmos utilizados**:
- Collaborative filtering (Matrix Factorization)
- Content-based filtering (TF-IDF)
- Hybrid recommendation system

**Exemplo de uso**:
```python
from src.insights.tools.advanced.recommendation_engine import RecommendationEngine

engine = RecommendationEngine()
result = engine._run(
    recommendation_type="product_recommendations",
    data_csv="data/vendas.csv",
    target_segment="vip",
    recommendation_count=10,
    confidence_threshold=0.8
)
```

**Output t√≠pico**:
```json
{
  "success": true,
  "analysis_type": "Product Recommendations Analysis",
  "recommendations": {
    "top_products": [
      {
        "product": "ALIANCA 750",
        "score": 0.95,
        "reason": "High affinity with VIP segment"
      }
    ]
  }
}
```

### 2. üéØ Customer Targeting
**Objetivo**: Segmentar clientes para campanhas direcionadas

**Algoritmos utilizados**:
- RFM Analysis (Recency, Frequency, Monetary)
- K-means clustering
- Customer scoring

**Segmentos autom√°ticos**:
- **VIP**: Alto valor + alta frequ√™ncia
- **High Value**: Alto valor + baixa frequ√™ncia  
- **Potential**: M√©dio valor + crescimento
- **At Risk**: Baixa atividade recente

### 3. üí∞ Pricing Optimization
**Objetivo**: Otimizar pre√ßos baseado em elasticidade e competi√ß√£o

**An√°lises realizadas**:
- Price elasticity analysis
- Competitive pricing
- Margin optimization
- Seasonal adjustments

### 4. üì¶ Inventory Suggestions
**Objetivo**: Otimizar gest√£o de estoque

**An√°lises realizadas**:
- ABC Analysis (produtos por revenue)
- Turnover rate analysis
- Restock priority
- Slow-moving items identification

### 5. üì¢ Marketing Campaigns
**Objetivo**: Criar campanhas personalizadas por segmento

**Funcionalidades**:
- Campaign type selection
- Channel optimization
- ROI estimation
- Message personalization

### 6. üéØ Strategic Actions
**Objetivo**: Identificar a√ß√µes estrat√©gicas priorit√°rias

**An√°lises realizadas**:
- Growth trend analysis
- Market opportunity identification
- Business intelligence insights
- Priority matrix

---

## ü§ù Integra√ß√£o com CrewAI

### Configura√ß√£o B√°sica
```python
from crewai import Agent, Task, Crew
from src.insights.tools.advanced.recommendation_engine import RecommendationEngine

# Criar agente com RecommendationEngine
sales_agent = Agent(
    role='Consultor de Vendas Especializado',
    goal='Maximizar vendas atrav√©s de recomenda√ß√µes personalizadas',
    backstory='''Especialista em joalheria com 10 anos de experi√™ncia.
    Utiliza an√°lise de dados avan√ßada para identificar oportunidades de venda.''',
    tools=[RecommendationEngine()],
    verbose=True
)
```

### Exemplos de Agentes

#### üéØ Sales Intelligence Agent
```python
sales_agent = Agent(
    role='Sales Intelligence Specialist',
    goal='Identify high-value sales opportunities through data analysis',
    backstory='Expert sales analyst with access to advanced ML recommendations',
    tools=[RecommendationEngine()],
    verbose=True
)

sales_task = Task(
    description='''
    Analyze customer purchase patterns and provide product recommendations
    for our VIP customers. Focus on cross-selling opportunities and 
    seasonal trends.
    ''',
    agent=sales_agent,
    expected_output='Detailed sales recommendations with confidence scores'
)
```

#### üìä Marketing Strategy Agent
```python
marketing_agent = Agent(
    role='Marketing Strategy Analyst',
    goal='Design data-driven marketing campaigns',
    backstory='Marketing specialist with expertise in customer segmentation',
    tools=[RecommendationEngine()],
    verbose=True
)

campaign_task = Task(
    description='''
    Segment our customer base and design personalized marketing campaigns.
    Include ROI projections and recommended channels for each segment.
    ''',
    agent=marketing_agent,
    expected_output='Marketing campaign strategy with segment-specific recommendations'
)
```

#### üí∞ Pricing Strategy Agent
```python
pricing_agent = Agent(
    role='Pricing Strategy Specialist', 
    goal='Optimize pricing for maximum profitability',
    backstory='Pricing analyst with expertise in jewelry market dynamics',
    tools=[RecommendationEngine()],
    verbose=True
)

pricing_task = Task(
    description='''
    Analyze our current pricing strategy and identify optimization opportunities.
    Consider market elasticity and competitive positioning.
    ''',
    agent=pricing_agent,
    expected_output='Pricing optimization recommendations with impact projections'
)
```

### Crew Assembly
```python
# Criar crew com m√∫ltiplos agentes
business_crew = Crew(
    agents=[sales_agent, marketing_agent, pricing_agent],
    tasks=[sales_task, campaign_task, pricing_task],
    verbose=2
)

# Executar an√°lise completa
result = business_crew.kickoff()
```

---

## üí° Exemplos Pr√°ticos

### Exemplo 1: An√°lise R√°pida de Vendas
```python
from src.insights.tools.advanced.recommendation_engine import RecommendationEngine

# Inicializar engine
engine = RecommendationEngine()

# An√°lise r√°pida de produtos
result = engine._run(
    recommendation_type="product_recommendations", 
    data_csv="data/vendas.csv",
    target_segment="all",
    recommendation_count=5,
    confidence_threshold=0.7
)

print(f"üìä Resultado: {len(result)} caracteres de an√°lise")
```

### Exemplo 2: Segmenta√ß√£o de Clientes VIP
```python
# Focar em clientes VIP para campanha especial
vip_analysis = engine._run(
    recommendation_type="customer_targeting",
    data_csv="data/vendas.csv", 
    target_segment="vip",
    recommendation_count=15,
    confidence_threshold=0.8,
    enable_detailed_analysis=True
)

# Resultado inclui scoring detalhado e a√ß√µes recomendadas
```

### Exemplo 3: Otimiza√ß√£o de Pre√ßos Sazonal
```python
# An√°lise de otimiza√ß√£o para per√≠odo espec√≠fico
pricing_optimization = engine._run(
    recommendation_type="pricing_optimization",
    data_csv="data/vendas.csv",
    target_segment="all",
    confidence_threshold=0.75
)

# Identifica oportunidades de ajuste de pre√ßo
```

### Exemplo 4: Pipeline Completo de An√°lise
```python
def run_complete_analysis(data_file):
    """Executa an√°lise completa do neg√≥cio."""
    engine = RecommendationEngine()
    
    analysis_types = [
        "product_recommendations",
        "customer_targeting", 
        "pricing_optimization",
        "inventory_suggestions",
        "marketing_campaigns",
        "strategic_actions"
    ]
    
    results = {}
    for analysis in analysis_types:
        results[analysis] = engine._run(
            recommendation_type=analysis,
            data_csv=data_file,
            target_segment="all",
            recommendation_count=10,
            confidence_threshold=0.7
        )
    
    return results

# Usar
complete_analysis = run_complete_analysis("data/vendas.csv")
```

---

## üìö API Reference

### RecommendationInput Schema
```python
class RecommendationInput(BaseModel):
    recommendation_type: str  # Tipo de an√°lise
    data_csv: str = "data/vendas.csv"  # Caminho do arquivo
    target_segment: str = "all"  # Segmento alvo
    recommendation_count: int = 10  # N√∫mero de recomenda√ß√µes
    confidence_threshold: float = 0.7  # Limiar de confian√ßa
    enable_detailed_analysis: bool = True  # An√°lise detalhada
```

### Tipos de Recomenda√ß√£o V√°lidos
```python
VALID_RECOMMENDATION_TYPES = [
    "product_recommendations",
    "customer_targeting", 
    "pricing_optimization",
    "inventory_suggestions",
    "marketing_campaigns",
    "strategic_actions"
]
```

### Segmentos Suportados
```python
VALID_SEGMENTS = ["all", "vip", "high_value", "potential", "at_risk"]
```

### M√©todo Principal
```python
def _run(
    self,
    recommendation_type: str,
    data_csv: str = "data/vendas.csv",
    target_segment: str = "all", 
    recommendation_count: int = 10,
    confidence_threshold: float = 0.7,
    enable_detailed_analysis: bool = True
) -> str:
    """
    Executa an√°lise de recomenda√ß√£o.
    
    Returns:
        str: JSON string com resultados da an√°lise
    """
```

---

## ‚ö° Performance e Monitoramento

### M√©tricas de Performance T√≠picas
```
üìä Benchmark Atual (dados reais - 4,461 registros):
- product_recommendations: ~0.37s
- customer_targeting: ~0.10s  
- pricing_optimization: ~0.09s
- inventory_suggestions: ~0.11s
- marketing_campaigns: ~0.09s
- strategic_actions: ~0.09s

Tempo m√©dio por execu√ß√£o: ~0.14s
```

### Cache Sistema
O sistema implementa cache inteligente:
- Hash dos dados para detectar mudan√ßas
- Cache por tipo de an√°lise
- Invalida√ß√£o autom√°tica quando dados mudam

### Monitoramento de Qualidade dos Dados
```python
# Verificar qualidade dos dados
quality_assessment = engine._assess_data_quality(df)
print(f"Score de Completude: {quality_assessment['completeness_score']:.1%}")
```

### Logs e Debugging
```python
import logging
logging.basicConfig(level=logging.INFO)

# Executar com logs detalhados
result = engine._run("product_recommendations", enable_detailed_analysis=True)
```

---

## üîß Troubleshooting

### Problemas Comuns

#### ‚ùå ImportError: M√≥dulo n√£o encontrado
```bash
# Solu√ß√£o: Adicionar ao PYTHONPATH
export PYTHONPATH="${PYTHONPATH}:/path/to/insights-ai"

# Ou no c√≥digo Python:
import sys
sys.path.append('/path/to/insights-ai')
```

#### ‚ùå FileNotFoundError: Arquivo de dados n√£o encontrado
```python
# Verificar se arquivo existe
import os
if not os.path.exists("data/vendas.csv"):
    print("‚ùå Arquivo n√£o encontrado")
    
# Usar caminho absoluto se necess√°rio
result = engine._run(
    recommendation_type="product_recommendations",
    data_csv="/caminho/completo/para/vendas.csv"
)
```

#### ‚ùå ValueError: Dados insuficientes
```python
# Verificar tamanho dos dados
df = pd.read_csv("data/vendas.csv", sep=';')
print(f"Registros: {len(df)}")
print(f"Clientes √∫nicos: {df['Codigo_Cliente'].nunique()}")

# M√≠nimo recomendado: 50+ registros, 10+ clientes
```

#### ‚ùå MemoryError: Dados muito grandes
```python
# Para datasets grandes (>100k registros):
# 1. Filtrar por per√≠odo
df_filtered = df[df['Data'] >= '2024-01-01']

# 2. Usar amostragem
df_sample = df.sample(n=10000, random_state=42)
```

### Performance Issues

#### üêå Execu√ß√£o lenta
```python
# Verificar tamanho dos dados
# Considerar sampling para datasets grandes
# Verificar qualidade dos dados

# Usar cache quando poss√≠vel
# Executar an√°lises em lotes durante hor√°rios de baixo uso
```

#### üíæ Alto uso de mem√≥ria
```python
# Processar dados em chunks
# Limpar cache periodicamente: engine._cache.clear()
# Usar tipos de dados otimizados (categorical, etc.)
```

---

## üìà Roadmap e Melhorias Futuras

### ‚úÖ Implementado (V2.0)
- Sistema completo de recomenda√ß√µes
- 6 tipos de an√°lises
- ML avan√ßado (SVD, TF-IDF, Isolation Forest)
- Integra√ß√£o CrewAI
- Cache inteligente
- Valida√ß√£o de dados
- Sistema de testes completo

### üîÑ Em Desenvolvimento (V2.1)
- API REST para integra√ß√£o externa
- Dashboard web interativo  
- Alertas autom√°ticos
- Integra√ß√£o com bancos de dados
- Modelos de deep learning

### üöÄ Planejado (V3.0)
- Real-time recommendations
- A/B testing framework
- Advanced anomaly detection
- Multi-tenant support
- Cloud deployment

---

## üìû Suporte

### Documenta√ß√£o Adicional
- `examples/recommendation_engine_demo.py` - Demonstra√ß√£o completa
- `src/tests/test_recommendation_engine_tool.py` - Suite de testes
- `docs/` - Documenta√ß√£o t√©cnica

### Executar Testes
```bash
# Executar todos os testes
pytest src/tests/test_recommendation_engine_tool.py -v

# Executar teste espec√≠fico
pytest src/tests/test_recommendation_engine_tool.py::TestRecommendationEngine::test_product_recommendations -v
```

### Demonstra√ß√£o Completa
```bash
# Executar demo interativa
python examples/recommendation_engine_demo.py
```

---

**RecommendationEngine V2.0** - Sistema Inteligente de Recomenda√ß√µes  
Desenvolvido para joalherias | Otimizado para CrewAI | ML Avan√ßado  
¬© 2025 Insights AI Team 